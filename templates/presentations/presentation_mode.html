<!DOCTYPE html>
<html lang="es" class="h-full">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{{ presentation.title }} - SlideMotion</title>

    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>


    <!-- MediaPipe tasks-vision CDN (Skypack) -->
    <script type="module">
    import { PoseLandmarker, FilesetResolver } from "https://cdn.skypack.dev/@mediapipe/tasks-vision@latest";
    // Hacer disponibles globalmente
    window.PoseLandmarker = PoseLandmarker;
    window.FilesetResolver = FilesetResolver;
    </script>

    <style>
        /* Fullscreen styles */
        .fullscreen {
            background: #000;
            color: #fff;
        }

        /* Ocultar scrollbars */
        body::-webkit-scrollbar {
            display: none;
        }
        body {
            -ms-overflow-style: none;
            scrollbar-width: none;
        }

        /* Animaciones de transici√≥n */
        .slide-transition {
            transition: opacity 0.3s ease-in-out;
        }

        /* Controles overlay */
        .controls-overlay {
            background: rgba(0, 0, 0, 0.7);
        }

        /* Estilos para gesture feedback */
        .gesture-feedback {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: rgba(0, 0, 0, 0.8);
            color: white;
            padding: 20px 40px;
            border-radius: 10px;
            font-size: 1.5rem;
            z-index: 1000;
            opacity: 0;
            transition: opacity 0.3s ease;
        }

        .gesture-feedback.show {
            opacity: 1;
        }

        /* Tipos de feedback */
        .gesture-feedback.success {
            background: rgba(16, 185, 129, 0.9);
            border: 2px solid #10b981;
        }

        .gesture-feedback.error {
            background: rgba(239, 68, 68, 0.9);
            border: 2px solid #ef4444;
        }

        .gesture-feedback.warning {
            background: rgba(245, 158, 11, 0.9);
            border: 2px solid #f59e0b;
            color: black;
        }

        .gesture-feedback.info {
            background: rgba(59, 130, 246, 0.9);
            border: 2px solid #3b82f6;
        }
    </style>
</head>

<body class="h-full m-0 p-0 overflow-hidden fullscreen">
    <!-- Slide Principal -->
    <div id="slide-container" class="h-full w-full flex items-center justify-center relative">
        <img id="current-slide"
             src="{{ current_slide.image_file.url }}"
             alt="Slide {{ current_slide_number }}"
             class="max-h-full max-w-full object-contain slide-transition">

    </div>

    <!-- Controles Overlay (se ocultan autom√°ticamente) -->
    <div id="controls-overlay" class="fixed inset-0 controls-overlay opacity-0 transition-opacity duration-300 pointer-events-none">
        <!-- Header con info de presentaci√≥n -->
        <div class="absolute top-0 left-0 right-0 p-4 flex justify-between items-center">
            <div class="text-lg font-medium">
                {{ presentation.title }}
            </div>
            <div class="text-sm">
                <span id="current-slide-number">{{ current_slide_number }}</span> / <span id="total-slides">{{ total_slides }}</span>
            </div>
        </div>

        <!-- Footer con controles -->
        <div class="absolute bottom-0 left-0 right-0 p-4 flex justify-between items-center">
            <div class="flex space-x-4">
                <button id="prev-btn"
                        class="px-4 py-2 bg-blue-600 hover:bg-blue-700 rounded-md transition pointer-events-auto">
                    ‚Üê Anterior
                </button>
                <button id="next-btn"
                        class="px-4 py-2 bg-blue-600 hover:bg-blue-700 rounded-md transition pointer-events-auto">
                    Siguiente ‚Üí
                </button>
            </div>

            <div class="flex space-x-4 items-center">
                <button id="gesture-toggle"
                        class="px-4 py-2 bg-green-600 hover:bg-green-700 rounded-md transition pointer-events-auto">
                    ü§ö Activar Gestos
                </button>
                <div class="text-xs text-gray-300">
                    <div>G: Activar/desactivar gestos</div>
                    <div>Flechas/Espacio: Navegar | Esc: Salir</div>
                </div>
                <a href="{% url 'presentations:presentation_detail' presentation.pk %}"
                   class="px-4 py-2 bg-red-600 hover:bg-red-700 rounded-md transition pointer-events-auto">
                    ‚úï Salir
                </a>
            </div>
        </div>
    </div>

    <!-- Feedback de gestos -->
    <div id="gesture-feedback" class="gesture-feedback">
        Gesto detectado
    </div>

    <!-- Camera overlay para gestos (muy peque√±o por defecto) -->
    <!-- Camera overlay para gestos (oculto por defecto) -->
    <div id="camera-overlay" class="fixed bg-gray-900 rounded-lg overflow-hidden transition-all duration-300 z-50"
         style="top: 16px; right: 16px; width: 256px; height: 192px; opacity: 0; display: none;">
        <video id="gesture-camera"
               class="w-full h-full object-cover"
               autoplay muted playsinline>
        </video>
        <canvas id="gesture-canvas"
                class="absolute inset-0 w-full h-full"
                style="pointer-events: none;">
        </canvas>
    </div>

    <!-- JavaScript para funcionalidad de presentaci√≥n -->
    {% load static %}
    <script src="{% static 'js/gesture_detection.js' %}"></script>
    <script src="{% static 'js/presentation_mode.js' %}"></script>

    <script>
        // Inicializaci√≥n cuando el DOM est√© listo
        document.addEventListener('DOMContentLoaded', function() {
            // Configuraci√≥n inicial desde Django template
            const config = {
                currentSlideNumber: {{ current_slide_number }},
                totalSlides: {{ total_slides }},
                presentationId: {{ presentation.pk }},
                detailUrl: "{% url 'presentations:presentation_detail' presentation.pk %}"
            };

            // Inicializar modo presentaci√≥n
            initializePresentationMode(config);
        });
    </script>
</body>
</html>