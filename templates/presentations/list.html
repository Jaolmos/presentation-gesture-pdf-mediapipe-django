{% extends 'base.html' %}

{% block title %}{{ title }} - SlideMotion{% endblock %}

{% block content %}
    <!-- Header con filtros -->
    <div class="mb-8">
        <div class="flex justify-between items-center mb-6">
            <h1 class="text-3xl font-bold text-gray-900">
                {{ title }}
            </h1>
            <a href="{% url 'presentations:upload' %}"
               class="bg-primary text-white px-4 py-2 rounded-md hover:bg-blue-700 transition">
                Subir presentación
            </a>
        </div>

        <!-- Filtros y búsqueda -->
        <div class="bg-white rounded-lg shadow-sm p-4">
            <form hx-get="{% url 'presentations:list_content' %}"
                  hx-target="#content-container"
                  hx-trigger="submit, keyup delay:500ms from:#search, change from:#converted"
                  class="flex flex-wrap gap-4 items-end">
                <!-- Búsqueda -->
                <div class="flex-1 min-w-64">
                    <label for="search" class="block text-sm font-medium text-gray-700 mb-1">
                        Buscar presentaciones
                    </label>
                    <input type="text"
                           id="search"
                           name="search"
                           value="{{ search_query }}"
                           placeholder="Buscar por título..."
                           class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-primary focus:border-primary">
                </div>

                <!-- Filtro por estado -->
                <div>
                    <label for="converted" class="block text-sm font-medium text-gray-700 mb-1">
                        Estado
                    </label>
                    <select id="converted"
                            name="converted"
                            class="px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-primary focus:border-primary">
                        <option value="">Todos</option>
                        <option value="yes" {% if converted_filter == 'yes' %}selected{% endif %}>
                            Convertidos
                        </option>
                        <option value="no" {% if converted_filter == 'no' %}selected{% endif %}>
                            Pendientes
                        </option>
                    </select>
                </div>

                <!-- Botones -->
                <div class="flex space-x-2">
                    <button type="submit"
                            class="bg-primary text-white px-4 py-2 rounded-md hover:bg-blue-700 transition">
                        Filtrar
                    </button>
                    <button type="button"
                           hx-get="{% url 'presentations:list_content' %}"
                           hx-target="#content-container"
                           onclick="document.getElementById('search').value=''; document.getElementById('converted').value='';"
                           class="px-4 py-2 border border-gray-300 rounded-md text-gray-700 hover:bg-gray-50 transition">
                        Limpiar
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- Contenedor dinámico para lista de presentaciones -->
    <div id="content-container"
         hx-get="{% url 'presentations:list_content' %}{% if search_query or converted_filter %}?{% if search_query %}search={{ search_query }}{% endif %}{% if search_query and converted_filter %}&{% endif %}{% if converted_filter %}converted={{ converted_filter }}{% endif %}{% endif %}"
         hx-trigger="load">
        <!-- El contenido se carga dinámicamente -->
        <div class="flex justify-center py-8">
            <div class="animate-spin rounded-full h-8 w-8 border-b-2 border-primary"></div>
        </div>
    </div>
{% endblock %}